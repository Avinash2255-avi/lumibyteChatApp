{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\user\\\\Downloads\\\\lumibyte_chat_app\\\\frontend\\\\src\\\\components\\\\ChatWindow.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useRef } from 'react';\nimport { useParams } from 'react-router-dom';\nimport TableResponse from './TableResponse';\nimport ChatInput from './ChatInput';\nimport AnswerFeedback from './AnswerFeedback';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction makeMessageId(msg, idx) {\n  // Prefer an existing stable timestamp or id; otherwise create one\n  if (msg.id) return msg.id;\n  if (msg.time) return `msg-${msg.time}`;\n  return `msg-${Date.now()}-${idx}-${Math.floor(Math.random() * 1000)}`;\n}\nexport default function ChatWindow() {\n  _s();\n  const {\n    sessionId\n  } = useParams();\n  const [history, setHistory] = useState([]);\n  const containerRef = useRef();\n\n  // Fetch session history and ensure each message has an id\n  useEffect(() => {\n    if (!sessionId) {\n      setHistory([]);\n      return;\n    }\n    fetch(`http://localhost:4000/api/session/${sessionId}`).then(r => {\n      if (!r.ok) throw new Error('Failed to fetch session');\n      return r.json();\n    }).then(data => {\n      const incoming = (data.history || []).map((m, i) => ({\n        ...m,\n        id: makeMessageId(m, i)\n      }));\n      setHistory(incoming);\n    }).catch(err => {\n      console.error('Load session error:', err);\n      setHistory([]);\n    });\n  }, [sessionId]);\n\n  // Scroll to bottom whenever history changes\n  useEffect(() => {\n    const el = containerRef.current;\n    if (!el) return;\n    // small delay to ensure DOM updated\n    setTimeout(() => {\n      el.scrollTo({\n        top: el.scrollHeight,\n        behavior: 'smooth'\n      });\n    }, 50);\n  }, [history]);\n  async function send(question) {\n    if (!sessionId) {\n      // optional: show a friendly message\n      alert('No session selected. Click New Chat first.');\n      return;\n    }\n    if (!question || !question.trim()) return;\n\n    // add user message immediately (optimistic)\n    const userMsg = {\n      id: `msg-${Date.now()}-user`,\n      from: 'user',\n      text: question\n    };\n    setHistory(h => [...h, userMsg]);\n    try {\n      const resp = await fetch(`http://localhost:4000/api/chat/${sessionId}`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          question\n        })\n      });\n      if (!resp.ok) throw new Error('Chat API error');\n      const body = await resp.json();\n      const botMsg = {\n        id: `msg-${Date.now()}-bot`,\n        from: 'bot',\n        text: body.text || '',\n        structured: body.structured || []\n      };\n      setHistory(h => [...h, botMsg]);\n    } catch (err) {\n      console.error('Send error:', err);\n      // Optionally push an error message into history or show toast\n      setHistory(h => [...h, {\n        id: `msg-${Date.now()}-err`,\n        from: 'bot',\n        text: 'Error: failed to get response'\n      }]);\n    }\n  }\n  function handleFeedback(messageId, fb) {\n    setHistory(prev => prev.map(m => m.id === messageId ? {\n      ...m,\n      feedback: fb\n    } : m));\n    // If you want persistence, call backend here to save feedback for messageId\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex flex-col h-[80vh] border rounded p-3 bg-white dark:bg-gray-800\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 overflow-auto mb-3\",\n      ref: containerRef,\n      children: [history.length === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-6 text-gray-500\",\n        children: \"No messages yet \\u2014 ask something!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 34\n      }, this), history.map(m => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `mb-4 ${m.from === 'user' ? 'text-right' : ''}`,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: `inline-block p-3 rounded ${m.from === 'user' ? 'bg-blue-100 dark:bg-blue-900' : 'bg-gray-100 dark:bg-gray-700'}`,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-sm\",\n            children: m.text\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 99,\n            columnNumber: 15\n          }, this), m.structured && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-2\",\n            children: /*#__PURE__*/_jsxDEV(TableResponse, {\n              data: m.structured\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 100,\n              columnNumber: 54\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 100,\n            columnNumber: 32\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 13\n        }, this), m.from === 'bot' && /*#__PURE__*/_jsxDEV(AnswerFeedback, {\n          initial: m.feedback || 'none',\n          onFeedback: fb => handleFeedback(m.id, fb)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 15\n        }, this)]\n      }, m.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 11\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ChatInput, {\n      onSend: send\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 93,\n    columnNumber: 5\n  }, this);\n}\n_s(ChatWindow, \"Y9wkBmYw+rI6eXlDJ4fH7UdW3/0=\", false, function () {\n  return [useParams];\n});\n_c = ChatWindow;\nvar _c;\n$RefreshReg$(_c, \"ChatWindow\");","map":{"version":3,"names":["React","useEffect","useState","useRef","useParams","TableResponse","ChatInput","AnswerFeedback","jsxDEV","_jsxDEV","makeMessageId","msg","idx","id","time","Date","now","Math","floor","random","ChatWindow","_s","sessionId","history","setHistory","containerRef","fetch","then","r","ok","Error","json","data","incoming","map","m","i","catch","err","console","error","el","current","setTimeout","scrollTo","top","scrollHeight","behavior","send","question","alert","trim","userMsg","from","text","h","resp","method","headers","body","JSON","stringify","botMsg","structured","handleFeedback","messageId","fb","prev","feedback","className","children","ref","length","fileName","_jsxFileName","lineNumber","columnNumber","initial","onFeedback","onSend","_c","$RefreshReg$"],"sources":["C:/Users/user/Downloads/lumibyte_chat_app/frontend/src/components/ChatWindow.js"],"sourcesContent":["import React, {useEffect, useState, useRef} from 'react';\nimport { useParams } from 'react-router-dom';\nimport TableResponse from './TableResponse';\nimport ChatInput from './ChatInput';\nimport AnswerFeedback from './AnswerFeedback';\n\nfunction makeMessageId(msg, idx) {\n  // Prefer an existing stable timestamp or id; otherwise create one\n  if (msg.id) return msg.id;\n  if (msg.time) return `msg-${msg.time}`;\n  return `msg-${Date.now()}-${idx}-${Math.floor(Math.random()*1000)}`;\n}\n\nexport default function ChatWindow(){\n  const { sessionId } = useParams();\n  const [history, setHistory] = useState([]);\n  const containerRef = useRef();\n\n  // Fetch session history and ensure each message has an id\n  useEffect(()=> {\n    if (!sessionId) {\n      setHistory([]);\n      return;\n    }\n\n    fetch(`http://localhost:4000/api/session/${sessionId}`)\n      .then(r => {\n        if (!r.ok) throw new Error('Failed to fetch session');\n        return r.json();\n      })\n      .then(data => {\n        const incoming = (data.history || []).map((m, i) => ({ ...m, id: makeMessageId(m, i) }));\n        setHistory(incoming);\n      })\n      .catch((err) => {\n        console.error('Load session error:', err);\n        setHistory([]);\n      });\n  }, [sessionId]);\n\n  // Scroll to bottom whenever history changes\n  useEffect(() => {\n    const el = containerRef.current;\n    if (!el) return;\n    // small delay to ensure DOM updated\n    setTimeout(() => {\n      el.scrollTo({ top: el.scrollHeight, behavior: 'smooth' });\n    }, 50);\n  }, [history]);\n\n  async function send(question){\n    if (!sessionId) {\n      // optional: show a friendly message\n      alert('No session selected. Click New Chat first.');\n      return;\n    }\n    if (!question || !question.trim()) return;\n\n    // add user message immediately (optimistic)\n    const userMsg = { id: `msg-${Date.now()}-user`, from: 'user', text: question };\n    setHistory(h => [...h, userMsg]);\n\n    try {\n      const resp = await fetch(`http://localhost:4000/api/chat/${sessionId}`, {\n        method: 'POST',\n        headers: {'Content-Type':'application/json'},\n        body: JSON.stringify({ question })\n      });\n      if (!resp.ok) throw new Error('Chat API error');\n      const body = await resp.json();\n\n      const botMsg = {\n        id: `msg-${Date.now()}-bot`,\n        from: 'bot',\n        text: body.text || '',\n        structured: body.structured || []\n      };\n\n      setHistory(h => [...h, botMsg]);\n    } catch (err) {\n      console.error('Send error:', err);\n      // Optionally push an error message into history or show toast\n      setHistory(h => [...h, { id: `msg-${Date.now()}-err`, from: 'bot', text: 'Error: failed to get response' }]);\n    }\n  }\n\n  function handleFeedback(messageId, fb) {\n    setHistory(prev => prev.map(m => (m.id === messageId ? { ...m, feedback: fb } : m)));\n    // If you want persistence, call backend here to save feedback for messageId\n  }\n\n  return (\n    <div className=\"flex flex-col h-[80vh] border rounded p-3 bg-white dark:bg-gray-800\">\n      <div className=\"flex-1 overflow-auto mb-3\" ref={containerRef}>\n        {history.length === 0 && <div className=\"p-6 text-gray-500\">No messages yet â€” ask something!</div>}\n        {history.map((m) => (\n          <div key={m.id} className={`mb-4 ${m.from === 'user' ? 'text-right' : ''}`}>\n            <div className={`inline-block p-3 rounded ${m.from==='user' ? 'bg-blue-100 dark:bg-blue-900' : 'bg-gray-100 dark:bg-gray-700'}`}>\n              <div className=\"text-sm\">{m.text}</div>\n              {m.structured && <div className=\"mt-2\"><TableResponse data={m.structured} /></div>}\n            </div>\n\n            {m.from === 'bot' && (\n              <AnswerFeedback\n                initial={m.feedback || 'none'}\n                onFeedback={(fb) => handleFeedback(m.id, fb)}\n              />\n            )}\n          </div>\n        ))}\n      </div>\n\n      <ChatInput onSend={send} />\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}