{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\user\\\\Downloads\\\\lumibyte_chat_app\\\\frontend\\\\src\\\\components\\\\ChatWindow.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useRef } from 'react';\nimport { useParams } from 'react-router-dom';\nimport TableResponse from './TableResponse';\nimport ChatInput from './ChatInput';\nimport AnswerFeedback from './AnswerFeedback';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function ChatWindow() {\n  _s();\n  const {\n    sessionId\n  } = useParams();\n  const [history, setHistory] = useState([]);\n  const containerRef = useRef();\n  useEffect(() => {\n    if (!sessionId) return;\n    fetch(`http://localhost:4000/api/session/${sessionId}`).then(r => r.json()).then(data => setHistory(data.history || [])).catch(() => setHistory([]));\n  }, [sessionId]);\n  function send(question) {\n    fetch(`http://localhost:4000/api/chat/${sessionId}`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        question\n      })\n    }).then(r => r.json()).then(resp => {\n      setHistory(h => [...h, {\n        from: 'user',\n        text: question\n      }, {\n        from: 'bot',\n        text: resp.text,\n        structured: resp.structured\n      }]);\n      // scroll\n      setTimeout(() => {\n        var _containerRef$current;\n        return (_containerRef$current = containerRef.current) === null || _containerRef$current === void 0 ? void 0 : _containerRef$current.scrollTo({\n          top: containerRef.current.scrollHeight,\n          behavior: 'smooth'\n        });\n      }, 100);\n    });\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex flex-col h-[80vh] border rounded p-3 bg-white dark:bg-gray-800\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex-1 overflow-auto mb-3\",\n      ref: containerRef,\n      children: [history.length === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-6 text-gray-500\",\n        children: \"No messages yet \\u2014 ask something!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 36,\n        columnNumber: 34\n      }, this), history.map((m, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `mb-4 ${m.from === 'user' ? 'text-right' : ''}`,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: `inline-block p-3 rounded ${m.from === 'user' ? 'bg-blue-100 dark:bg-blue-900' : 'bg-gray-100 dark:bg-gray-700'}`,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-sm\",\n            children: m.text\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 40,\n            columnNumber: 15\n          }, this), m.structured && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-2\",\n            children: /*#__PURE__*/_jsxDEV(TableResponse, {\n              data: m.structured\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 41,\n              columnNumber: 54\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 41,\n            columnNumber: 32\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 39,\n          columnNumber: 13\n        }, this), m.from === 'bot' && /*#__PURE__*/_jsxDEV(AnswerFeedback, {\n          initial: m.feedback || 'none',\n          onFeedback: fb => {\n            // store feedback in the history array for the corresponding message\n            setHistory(prev => {\n              const copy = [...prev];\n              // the bot message is at index i in map; since we are inside map, ensure you capture index\n              // If you render inside the `.map((m, i) => ...)` use `i` from the map callback:\n              copy[i] = {\n                ...copy[i],\n                feedback: fb\n              };\n              return copy;\n            });\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 44,\n          columnNumber: 3\n        }, this)]\n      }, i, true, {\n        fileName: _jsxFileName,\n        lineNumber: 38,\n        columnNumber: 11\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 35,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ChatInput, {\n      onSend: send\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 34,\n    columnNumber: 5\n  }, this);\n}\n_s(ChatWindow, \"zqIWIhHjCAzxugM68SFOYxblYaE=\", false, function () {\n  return [useParams];\n});\n_c = ChatWindow;\nvar _c;\n$RefreshReg$(_c, \"ChatWindow\");","map":{"version":3,"names":["React","useEffect","useState","useRef","useParams","TableResponse","ChatInput","AnswerFeedback","jsxDEV","_jsxDEV","ChatWindow","_s","sessionId","history","setHistory","containerRef","fetch","then","r","json","data","catch","send","question","method","headers","body","JSON","stringify","resp","h","from","text","structured","setTimeout","_containerRef$current","current","scrollTo","top","scrollHeight","behavior","className","children","ref","length","fileName","_jsxFileName","lineNumber","columnNumber","map","m","i","initial","feedback","onFeedback","fb","prev","copy","onSend","_c","$RefreshReg$"],"sources":["C:/Users/user/Downloads/lumibyte_chat_app/frontend/src/components/ChatWindow.js"],"sourcesContent":["import React, {useEffect, useState, useRef} from 'react';\nimport { useParams } from 'react-router-dom';\nimport TableResponse from './TableResponse';\nimport ChatInput from './ChatInput';\nimport AnswerFeedback from './AnswerFeedback';\n\nexport default function ChatWindow(){\n  const { sessionId } = useParams();\n  const [history, setHistory] = useState([]);\n  const containerRef = useRef();\n\n  useEffect(()=> {\n    if (!sessionId) return;\n    fetch(`http://localhost:4000/api/session/${sessionId}`)\n      .then(r=>r.json())\n      .then(data => setHistory(data.history || []))\n      .catch(()=>setHistory([]));\n  }, [sessionId]);\n\n  function send(question){\n    fetch(`http://localhost:4000/api/chat/${sessionId}`, {\n      method: 'POST',\n      headers: {'Content-Type':'application/json'},\n      body: JSON.stringify({ question })\n    }).then(r=>r.json())\n      .then(resp => {\n        setHistory(h => [...h, {from:'user', text: question}, {from:'bot', text: resp.text, structured: resp.structured}]);\n        // scroll\n        setTimeout(()=> containerRef.current?.scrollTo({ top: containerRef.current.scrollHeight, behavior: 'smooth' }), 100);\n      });\n  }\n\n  return (\n    <div className=\"flex flex-col h-[80vh] border rounded p-3 bg-white dark:bg-gray-800\">\n      <div className=\"flex-1 overflow-auto mb-3\" ref={containerRef}>\n        {history.length === 0 && <div className=\"p-6 text-gray-500\">No messages yet â€” ask something!</div>}\n        {history.map((m, i) => (\n          <div key={i} className={`mb-4 ${m.from === 'user' ? 'text-right' : ''}`}>\n            <div className={`inline-block p-3 rounded ${m.from==='user' ? 'bg-blue-100 dark:bg-blue-900' : 'bg-gray-100 dark:bg-gray-700'}`}>\n              <div className=\"text-sm\">{m.text}</div>\n              {m.structured && <div className=\"mt-2\"><TableResponse data={m.structured} /></div>}\n            </div>\n            {m.from === 'bot' && (\n  <AnswerFeedback\n    initial={m.feedback || 'none'}\n    onFeedback={(fb) => {\n      // store feedback in the history array for the corresponding message\n      setHistory(prev => {\n        const copy = [...prev];\n        // the bot message is at index i in map; since we are inside map, ensure you capture index\n        // If you render inside the `.map((m, i) => ...)` use `i` from the map callback:\n        copy[i] = { ...copy[i], feedback: fb };\n        return copy;\n      });\n    }}\n  />\n)}\n\n          </div>\n        ))}\n      </div>\n      <ChatInput onSend={send} />\n    </div>\n  )\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}